!function(t){"use strict";function e(){return{bindToController:!0,controller:o,controllerAs:"bus",link:function(t,e,o){},restrict:"E",scope:{options:"="}}}function o(e,o,n,i,r){var s={title:"Your Session is About to Expire!",message:"Your session is about to expire.",logoutButton:"Logout",keepAliveButton:"Stay Connected",keepAliveUrl:"/keep-alive",ajaxType:"POST",ajaxData:"",redirUrl:"/timed-out",logoutUrl:"/log-out",warnAfter:9e5,redirAfter:12e5,keepAliveInterval:5e3,keepAlive:!0,ignoreUserActivity:!1,onStart:!1,onWarn:!1,onRedir:!1,countdownMessage:!1,countdownBar:!1,countdownSmart:!1},u=null,a={},c=s,l=null;function d(){"function"==typeof c.redirUrl?window.location=c.redirUrl():window.location=c.redirUrl}if(this.options&&(c=t.extend(s,this.options)),c.warnAfter>=c.redirAfter)throw new Error('Bootstrap-session-timeout plugin is miss-configured. Option "redirAfter" must be equal or greater than "warnAfter".');if(!c.ignoreUserActivity){var f=[-1,-1];o.on("keyup mouseup mousemove touchend touchmove",function(t){if("mousemove"===t.type){if(t.clientX===f[0]&&t.clientY===f[1])return;f[0]=t.clientX,f[1]=t.clientY}m(),l&&l.close(),i(function(){l=null})})}var p=!1;function m(){i.cancel(u),(c.countdownMessage||c.countdownBar)&&b("session",!0),"function"==typeof c.onStart&&c.onStart(c),c.keepAlive&&function(){if(!p){var t=void 0;t="function"==typeof c.keepAliveUrl?c.keepAliveUrl():c.keepAliveUrl,n({method:c.ajaxType,url:t,data:c.ajaxData}),p=!0,i(function(){p=!1},c.keepAliveInterval)}}(),u=i(function(){"function"!=typeof c.onWarn?(l=r.open({animation:!0,template:'<div class="modal-content"><div class="modal-header"><h4>{{busm.options.title}}</h4></div><div class="modal-body"><p>{{busm.options.message}}</p><p ng-if="busm.options.countdownMessage"> {{busm.buildCountdownMessage(busm.countdown.timeLeft)}}</p><uib-progressbar ng-if="busm.options.countdownBar" class="progress-striped active" style="min-width:15px; width: 100%;" value="busm.countdown.percentLeft">{{busm.countdown.secText}}</uib-progressbar></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="busm.logout()">{{busm.options.logoutButton}}</button><button type="submit" class="btn btn-primary" ng-click="busm.stayLoggedIn()">{{busm.options.keepAliveButton}}</button></div></div>',controller:"BootstrapSessionTimeoutModalController",controllerAs:"busm",resolve:{options:c,countdown:a,redirectOptions:{redirect:d}}}))&&l.result.then(function(t){t&&m()},function(t){}):c.onWarn(c),function(){i.cancel(u),l||!c.countdownMessage&&!c.countdownBar||b("dialog",!0);u=i(function(){"function"!=typeof c.onRedir?d():c.onRedir(c)},c.redirAfter-c.warnAfter)}()},c.warnAfter)}function b(t,e){i.cancel(a.timer),"dialog"===t&&e?a.timeLeft=Math.floor((c.redirAfter-c.warnAfter)/1e3):"session"===t&&e&&(a.timeLeft=Math.floor(c.redirAfter/1e3));c.countdownBar&&"dialog"===t?a.percentLeft=Math.floor(a.timeLeft/((c.redirAfter-c.warnAfter)/1e3)*100):c.countdownBar&&"session"===t&&(a.percentLeft=Math.floor(a.timeLeft/(c.redirAfter/1e3)*100));var o=a.timeLeft>=0?a.timeLeft:0;if(c.countdownSmart){var n=Math.floor(o/60),r=o%60,s=n>0?n+"m":"";s.length>0&&(s+=" "),s+=r+"s",a.secText=s}else a.secText=o+"s";a.timeLeft=a.timeLeft<=0?0:a.timeLeft-1,a.timer=i(function(){b(t)},1e3)}m(),e.$on("$destroy",function(t){i.cancel(u)})}function n(t,e,o,n){var i=this,r=!1;i.options=e,i.countdown=o,i.logout=function(){n.redirect()},i.stayLoggedIn=function(){t.close(!0)},i.buildCountdownMessage=function(t){var e=0;0===t?(r||(e=t+1),r=!0):e=t+1;return i.options.countdownMessage.replace("{timer}",e)}}t.module("ngBootstrapSessionTimeout",["ui.bootstrap"]).directive("bootstrapSessionTimeout",e).controller("BootstrapSessionTimeoutModalController",n),e.$inject=[],o.$inject=["$scope","$document","$http","$timeout","$uibModal"],n.$inject=["$uibModalInstance","options","countdown","redirectOptions"]}(angular);
