!function(t){"use strict";function o(){return{bindToController:!0,controller:e,controllerAs:"bus",link:function(t,o,e){},restrict:"E",scope:{options:"="}}}function e(o,e,n,i,r){var s={title:"Your Session is About to Expire!",message:"Your session is about to expire.",logoutButton:"Logout",keepAliveButton:"Stay Connected",keepAliveUrl:"/keep-alive",ajaxType:"POST",ajaxData:"",redirUrl:"/timed-out",logoutUrl:"/log-out",warnAfter:9e5,redirAfter:12e5,keepAliveInterval:5e3,keepAlive:!0,ignoreUserActivity:!1,onStart:!1,onWarn:!1,onRedir:!1,countdownMessage:!1,countdownBar:!1,countdownSmart:!1},u=null,a={},l=s,c=null;if(this.options&&(l=t.extend(s,this.options)),l.warnAfter>=l.redirAfter)throw new Error('Bootstrap-session-timeout plugin is miss-configured. Option "redirAfter" must be equal or greater than "warnAfter".');if(!l.ignoreUserActivity){var d=[-1,-1];e.on("keyup mouseup mousemove touchend touchmove",function(t){if("mousemove"===t.type){if(t.clientX===d[0]&&t.clientY===d[1])return;d[0]=t.clientX,d[1]=t.clientY}p(),c&&c.close(),i(function(){c=null})})}var f=!1;function p(){i.cancel(u),(l.countdownMessage||l.countdownBar)&&m("session",!0),"function"==typeof l.onStart&&l.onStart(l),l.keepAlive&&(f||(n({method:l.ajaxType,url:l.keepAliveUrl,data:l.ajaxData}),f=!0,i(function(){f=!1},l.keepAliveInterval))),u=i(function(){"function"!=typeof l.onWarn?(c=r.open({animation:!0,template:'<div class="modal-content"><div class="modal-header"><h4>{{busm.options.title}}</h4></div><div class="modal-body"><p>{{busm.options.message}}</p><p ng-if="busm.options.countdownMessage"> {{busm.buildCountdownMessage(busm.countdown.timeLeft + 1)}}</p><uib-progressbar ng-if="busm.options.countdownBar" class="progress-striped active" style="min-width:15px;" value="busm.countdown.percentLeft">{{busm.countdown.secText}}</uib-progressbar></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="busm.logout()">{{busm.options.logoutButton}}</button><button type="submit" class="btn btn-primary" ng-click="busm.stayLoggedIn()">{{busm.options.keepAliveButton}}</button></div></div>',controller:"BootstrapSessionTimeoutModalController",controllerAs:"busm",resolve:{options:l,countdown:a}}))&&c.result.then(function(t){t&&p()},function(t){}):l.onWarn(l),function(){i.cancel(u),c||!l.countdownMessage&&!l.countdownBar||m("dialog",!0);u=i(function(){"function"!=typeof l.onRedir?window.location=l.redirUrl:l.onRedir(l)},l.redirAfter-l.warnAfter)}()},l.warnAfter)}function m(t,o){i.cancel(a.timer),"dialog"===t&&o?a.timeLeft=Math.floor((l.redirAfter-l.warnAfter)/1e3):"session"===t&&o&&(a.timeLeft=Math.floor(l.redirAfter/1e3));l.countdownBar&&"dialog"===t?a.percentLeft=Math.floor(a.timeLeft/((l.redirAfter-l.warnAfter)/1e3)*100):l.countdownBar&&"session"===t&&(a.percentLeft=Math.floor(a.timeLeft/(l.redirAfter/1e3)*100));var e=a.timeLeft>=0?a.timeLeft:0;if(l.countdownSmart){var n=Math.floor(e/60),r=e%60,s=n>0?n+"m":"";s.length>0&&(s+=" "),s+=r+"s",a.secText=s}else a.secText=e+"s";a.timeLeft=a.timeLeft<=0?0:a.timeLeft-1,a.timer=i(function(){m(t)},1e3)}p(),o.$on("$destroy",function(t){i.cancel(u)})}function n(t,o,e){var n=this;n.options=o,n.countdown=e,n.logout=function(){window.location=n.options.redirUrl},n.stayLoggedIn=function(){t.close(!0)},n.buildCountdownMessage=function(t){return n.options.countdownMessage.replace("{timer}",t)}}t.module("ngBootstrapSessionTimeout",["ui.bootstrap"]).directive("bootstrapSessionTimeout",o).controller("BootstrapSessionTimeoutModalController",n),o.$inject=[],e.$inject=["$scope","$document","$http","$timeout","$uibModal"],n.$inject=["$uibModalInstance","options","countdown"]}(angular);
